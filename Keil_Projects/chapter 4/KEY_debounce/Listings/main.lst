C51 COMPILER V9.57.0.0   MAIN                                                              01/30/2026 10:54:56 PAGE 1   


C51 COMPILER V9.57.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: d:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          #include "reg52.h"
   2          //#include "intrins.h"
   3          sbit key = P3^2;  //接INT0
   4          sbit led = P2^0;
   5          
   6          typedef enum
   7          {
   8                  KEY_STATE_IDL,                          // 等待按键
   9                  KEY_STATE_DEBOUNCE,                     // 按键消抖
  10                  KEY_STATE_WAIT_RELEASE,         // 等待按键释放
  11          }t_key_state;
  12          typedef unsigned char   u8;
  13          typedef unsigned int    u16;
  14          
  15          volatile t_key_state key_state = KEY_STATE_IDL;
  16          
  17          
  18          
  19          /* ================= 系统时钟 ================= */
  20          volatile u16 g_sys_tick = 0; // 系统时钟，单位：50ms
  21          /* =============== Timer0 中断 =============== */
  22          void timer0_isr(void) interrupt 1
  23          {
  24   1              TH0 = 0xDC; // （11.0592MHz）1ms, 10ms, 50ms时，重装值分别为0xFC66， 0xDC00，0x4C00
  25   1              TL0 = 0x00;
  26   1              g_sys_tick++; // 系统时间前进一步
  27   1      }
  28          
  29          void key_detect(void)
  30          {
  31   1              static u16 debounce_last_tick = 0;
  32   1              switch(key_state)
  33   1              {
  34   2                      case KEY_STATE_IDL: 
  35   2                              if(key == 0)
  36   2                              {       debounce_last_tick = g_sys_tick;  //记录消抖开始时间
  37   3                                      key_state = KEY_STATE_DEBOUNCE;
  38   3                              }
  39   2                              break;
  40   2                      case KEY_STATE_DEBOUNCE:
  41   2                              if(g_sys_tick - debounce_last_tick >= 1)
  42   2                              {
  43   3                                      debounce_last_tick = g_sys_tick;
  44   3                                      if(key == 0)
  45   3                                      {
  46   4                                              key_state = KEY_STATE_WAIT_RELEASE;
  47   4                                              led = 0;  //按键后，LED亮
  48   4                                      }
  49   3                                      else
  50   3                                              key_state = KEY_STATE_IDL;
  51   3                              }                               
  52   2                              break;
  53   2                      case KEY_STATE_WAIT_RELEASE:
  54   2                              if(key == 1)
C51 COMPILER V9.57.0.0   MAIN                                                              01/30/2026 10:54:56 PAGE 2   

  55   2                              {
  56   3                                      key_state = KEY_STATE_IDL;
  57   3                                      led = 1;  //按键释放后，LED灭
  58   3                              }
  59   2                              break;
  60   2              }
  61   1      }
  62          
  63          void init_timer0(void)
  64          {
  65   1              TMOD &= 0xF0;   // 清 Timer0 控制位
  66   1              TMOD |= 0x01;   // Timer0 工作方式 1（16 位）
  67   1              TH0 = 0xDC;
  68   1              TL0 = 0x00;
  69   1              ET0 = 1;        // 允许 Timer0 中断
  70   1              EA  = 1;        // 开总中断
  71   1              TR0 = 1;        // 启动 Timer0
  72   1              EX0 = 1;  // 使能中断0
  73   1      }
  74          
  75          void main(void)
  76          {
  77   1              init_timer0();
  78   1              while(1)
  79   1              {
  80   2                      key_detect();
  81   2              }
  82   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    121    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      5    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
