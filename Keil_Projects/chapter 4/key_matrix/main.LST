C51 COMPILER V9.57.0.0   MAIN                                                              01/20/2026 19:47:17 PAGE 1   


C51 COMPILER V9.57.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: d:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /* Main.c file generated by New Project wizard
   2           *
   3           * Created:   ?? 1? 19 2026
   4           * Processor: 80C31
   5           * Compiler:  Keil for 8051
   6           */
   7          
   8          #include "reg52.h"
   9          
  10          #define SMG_PORT P0
  11          #define KEY_MATRIX_PORT P1
  12          
  13          typedef unsigned char u8;
  14          typedef unsigned int u16;
  15          
  16          sbit LSA = P2^2;
  17          sbit LSB = P2^3;
  18          sbit LSC = P2^4;
  19          
  20          
  21          
  22          u8 gsmg_code[] = {
  23                  0x3f, 0x06, 0x5b, 0x4f, 0x66, 0x6d, 0x7d, 0x07, 
  24                  0x7f, 0x6f, 0x77, 0x7c, 0x39, 0x5e, 0x79, 0x71
  25          };  // common negative SSD. 0~9, A~F
  26          
  27          void delay_10us(u16 ten_us)
  28          {
  29   1              while(ten_us--);
  30   1      }
  31          
  32          u8 key_matrix_ranks_scan(void)
  33          {
  34   1              u8 key_value = 0; // the key which is pressed.
  35   1              KEY_MATRIX_PORT = 0xf7;  // set the first column line to 0.
  36   1              if(KEY_MATRIX_PORT != 0xf7)
  37   1              {
  38   2                      delay_10us(1000);
  39   2                      switch(KEY_MATRIX_PORT)
  40   2                      {
  41   3                              case 0x77: key_value = 1; break;
  42   3                              case 0xb7: key_value = 5; break;
  43   3                              case 0xd7: key_value = 9; break;
  44   3                              case 0xe7: key_value = 13; break;
  45   3                      }
  46   2              }
  47   1              KEY_MATRIX_PORT = 0xfb;  // set the second column line to 0.
  48   1              if(KEY_MATRIX_PORT != 0xfb)
  49   1              {
  50   2                      delay_10us(1000);
  51   2                      switch(KEY_MATRIX_PORT)
  52   2                      {
  53   3                              case 0x7b: key_value = 2; break;
  54   3                              case 0xbb: key_value = 6; break;
  55   3                              case 0xdb: key_value = 10; break;
C51 COMPILER V9.57.0.0   MAIN                                                              01/20/2026 19:47:17 PAGE 2   

  56   3                              case 0xeb: key_value = 14; break;
  57   3                      }
  58   2              }
  59   1              KEY_MATRIX_PORT = 0xfd;  // set the third column line to 0.
  60   1              if(KEY_MATRIX_PORT != 0xfd)
  61   1              {
  62   2                      delay_10us(1000);
  63   2                      switch(KEY_MATRIX_PORT)
  64   2                      {
  65   3                              case 0x7d: key_value = 3; break;
  66   3                              case 0xbd: key_value = 7; break;
  67   3                              case 0xdd: key_value = 11; break;
  68   3                              case 0xed: key_value = 15; break;
  69   3                      }
  70   2              }
  71   1              KEY_MATRIX_PORT = 0xfe;  // set the forth column line to 0.
  72   1              if(KEY_MATRIX_PORT != 0xfe)
  73   1              {
  74   2                      delay_10us(1000);
  75   2                      switch(KEY_MATRIX_PORT)
  76   2                      {
  77   3                              case 0x7e: key_value = 4; break;
  78   3                              case 0xbe: key_value = 8; break;
  79   3                              case 0xde: key_value = 12; break;
  80   3                              case 0xee: key_value = 16; break;
  81   3                      }
  82   2              }
  83   1              return key_value;
  84   1      }
  85          
  86          void main(void)
  87          { 
  88   1              while (1)
  89   1              {       
  90   2                      u8 key_value = 0;
  91   2                      LSC = 0; LSB = 0; LSA = 0;
  92   2                      key_value = key_matrix_ranks_scan();
  93   2                      if(key_value != 0) // this if satement is very important.
  94   2                              SMG_PORT = gsmg_code[key_value-1];
  95   2              }
  96   1      }
  97          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    243    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     16       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
